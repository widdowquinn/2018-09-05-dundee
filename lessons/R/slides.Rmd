---
title: "Programming in R"
author: "Leighton Pritchard"
date: "05/09/2018"
output:
  ioslides_presentation:
    css: ./includes/custom.css
    font-family: 'Helvetica'
    widescreen: True
    self_contained: True
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Etherpad

<div class="attention">
Please do take notes on the course `etherpad`:
</div>

[http://pad.software-carpentry.org/2018-09-05-dundee](http://pad.software-carpentry.org/2018-09-05-dundee)

<div class="highlight">
- **Communal notes**: share your understanding, and benefit from others
- **Ask questions**: get detailed answers with links and examples
- **A record/reference for after the course**
</div>


## Learning Objectives

- Fundamentals of `RStudio` (refresher)
- `RStudio` project creation and version control (refresher)
- Flow control in `R` (refresher)
- Functions in `R` (refresher)
- Literate programming with `RMarkdown` and `knitr`
- Good practice for programming and project management

<div class="attention">
**We're assuming some familiarity with:**

- `R` syntax, data types and structures (especially `data.frame`s)
- variables and variable assignment (`<-`)
- using `R` packages
- `R` base graphics/`ggplot2`
</div>

<!-- SECTION 01: `RStudio` -->

# SECTION 01: `RStudio`

## Learning Objectives

- The elements of an `RStudio` session
  - interactive code
  - writing scripts/documents
  - live view of graphical output
  - getting help
  - interaction with the filesystem
  - project and environment management


## What is `RStudio`?

* `RStudio` is an *integrated development environment* (IDE) - all platforms

<center>
<img src="images/rstudio_window.png" width="50%" />
<img src="images/RStudio-Screenshot.png" width="40%" />
</center>

<div class="highlight">
- Interaction with `R` (console/'scratchpad')
- Script/code editor
- Graphics/visualisation
- Project management (`git` integration)
</div>

## `RStudio` overview - Interactive Demo

<center>
<img src="images/rstudio-start-view.png" width="65%" />
</center>

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

<img src="images/red_green_sticky.png" width="100%" />


## Built-in Functions

- Function (`log()`, `sin()` etc.) ≈ "canned script"
  - automate complicated tasks
  - make code more readable and reusable
- Some functions are built-in (in *base* packages, e.g. `sqrt()`, `lm()`, `plot()`)
- Some functions are *imported* from *libraries*

<div class="highlight">
- Functions usually take *arguments* (*input*)
- Functions often *return* values (*output*)
</div>

<center>
<div class="attention">
INTERACTIVE DEMO
</div>
</center>


## Getting Help For Built-in Functions

<center>
<div class="attention">
INTERACTIVE DEMO
</div>
</center>

```{r, eval=FALSE}
?fname                 # help page for fname
help(fname)            # help page for fname
??fname                # any mention of fname
args(fname)            # arguments for fname
vignette(fname)        # worked examples for fname
vignette()             # show all available vignettes
help.search("text")    # any mention of "text"
```


## Numerical comparisons

- Computers can have limits to numeric precision
  - (they do what you tell them, not necessarily what you want)

<center>
<div class="attention">
INTERACTIVE DEMO
</div>
</center>
  
```{r, eval=FALSE}
> pi - 1e-8 == pi
[1] FALSE
> all.equal(pi - 1e-8, pi)
[1] TRUE
```

```{r, eval=FALSE}
> log(0.01 ^ 200)
[1] -Inf
> 200 * log(0.01)
[1] -921.034
```

<img src="images/red_green_sticky.png" width="100%" />


## Working in `RStudio`

<div class="highlight">
We can write code in several ways in `RStudio`
</div>

- At the console (you've done this)
- In a script
- As an interactive notebook or markdown file
- As a Shiny app

We're going to create a new dataset and `R` script.

- Putting code in a script makes it easier to modify, share and run

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

<img src="images/red_green_sticky.png" width="100%" />


<!-- SECTION 02: My First `RStudio` Project -->

# SECTION 02: <br />My First `RStudio` Project

## Learning Objectives

- Good practice for `RStudio` project structure
- Load data into an `RStudio` project
- Produce summary statistics of data
- Extract subsets of data
- Plotting data in `R`


## Good Project Management Practices

<div class="highlight">
**No single 'right way' - only good principles**
</div>

- Use a single working directory per project/analysis
  - easier to move, share, and find files
  - use *relative paths* to locate files
- Treat raw data as read-only
  - keep in separate subfolder (`data`?)
- Clean data ready for work/analysis
  - keep cleaned/modified data in separate folder (`clean_data`?)
- Consider output generated by analysis to be disposable
  - can be regenerated by running analysis/code
  - don't place under version control

<div class="references">
- Good Enough Practices in Scientific Computing (2017) Wilson *et al.* <http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510>
</class>

## Example Directory Structure

<center>
<img src="images/working-directory-structure.png" width="100%" />
</center>


## Project Management in `RStudio`

- `RStudio` tries to help you manage your projects
  - `R Project` concept - files and subdirectory structure
  - integration with version control
  - switching between multiple projects within `RStudio`
  - stores project history
    
<div class="highlight">
**Let's create a project in `RStudio`**
</div>

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

<img src="images/red_green_sticky.png" width="100%" />

<div class="references">
`RStudio` projects: <https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects>
</div>


## Obtaining Data

- You created data manually earlier, but this is rare
- Data are most commonly read in from plain text files

<div class="highlight">
* Download data from [https://raw.githubusercontent.com/widdowquinn/2018-09-05-dundee/gh-pages/lessons/R/gapminder-FiveYearData.csv](https://raw.githubusercontent.com/widdowquinn/2018-09-05-dundee/gh-pages/lessons/R/gapminder-FiveYearData.csv)
* Put the file in the new project's `data/` directory

**A link is also available on the course Etherpad**
</div>

<div class="attention">
Data files can be inspected in `RStudio`
</div>

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>


## Investigating `gapminder`

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

```{r, eval=FALSE}
gapminder <- read.table("data/gapminder-FiveYearData.csv", sep=",", header=TRUE)
```

```{r, eval=FALSE}
str(gapminder)              # structure of the data.frame
typeof(gapminder$year)      # data type of a column
length(gapminder)           # length of the data.frame
nrow(gapminder)             # number of rows in data.frame
ncol(gapminder)             # number of columns in data.frame
dim(gapminder)              # number of rows and columns in data.frame
colnames(gapminder)         # column names from data.frame
head(gapminder)             # first few rows of dataframe
summary(gapminder)          # summary of data in data.frame columns
```


<!-- SECTION 03: Program Flow Control -->

# SECTION 03: Program Flow Control

## Learning Objectives

- How to make data-dependent choices in `R`
- Use `if()` and `else()`
- Repeat operations in `R`
- Use `for()` loops
- *vectorisation* to avoid repeating operations


## `if()` … `else`

- We often want to perform operations (or not) *conditional* on a piece of data
  - The `if()` and `else` construct is useful for this
    
```R
# if
if (condition is true) {
  PERFORM ACTION
}

# if ... else
if (condition is true) {
  PERFORM ACTION
} else {  # i.e. if the condition is false,
  PERFORM ALTERNATIVE ACTION
}
```

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>


## Challenge (5min)

**In the console**, can you use an `if()` statement to report whether there are any records from 2002 in the `gapminder` dataset?

Can you do the same for 2012?

<div class="attention">
**HINT:** Look at the help for the `any()` function
</div>

<img src="images/red_green_sticky.png" width="100%" />


## `for()` loops

- `for()` loops are a very common construction in programming
  - `for` each `<item>` in a group, `<do something (with the item)>`
- Not as useful in `R` as in some other languages

```{r, eval=FALSE}
for(iterator in set of values){
  do a thing
}
```

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>


## `while()` loops

- `while()` loops are useful when you need to *do something* **while** some condition is true

```{r, eval=FALSE}
while(this condition is true){
  do a thing
}
```

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>


## Challenge (5min)

**In your script**, can you use a `for()` loop and an `if()` statement to loop over each country in the `gapminder` data, and report `TRUE` when it starts with the letter `M`, and `FALSE` when it does not?

<div class="attention">
**HINT:** Use `R`'s built in `startsWith()` function

**HINT:** Use `levels()` to get unique country names
</div>

<img src="images/red_green_sticky.png" width="100%" />

<div class="highlight">
**Commit the script to the repository when you are done**
</div>

## Vectorisation

- `for()` and `while()` loops are useful for program control (making decisions), but are not *efficient* for data manipulation in `R`
- Many operations in `R` are *vectorised*
  - Applying functions to a *vector*, applies to all elements in that *vector*
  - **No need to loop**
    
<div class="highlight">
You've already seen and used much of this behaviour
</div>
    
<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

```{r, eval=FALSE}
x < 1:4
x * 2
y <- 6:9
x + y
```

## Challenge (5min)

**In your script**, can you use vectorisation to identify all countries in the `gapminder` data that start with the letter `M`?

<div class="attention">
**HINT:** Use `levels()` to get unique country names

**HINT:** Use `R`'s built in `startsWith()` function

**HINT:** Use *logical indexing*
</div>

<img src="images/red_green_sticky.png" width="100%" />


<!-- SECTION 04: FUNCTIONS -->

# SECTION 04: Functions

## Learning Objectives

- Why functions are important
- How to write a new function
- Defining a function that takes arguments
- Returning a value from a function
- Set default values for function arguments


## Why Functions?

- Functions let us run a complex series of commands in one go
  - under a memorable/descriptive name
  - invoked with that name
  - with a defined set of inputs and outputs
  - to perform a logically coherent task
    
<div class="highlight">    
Functions are the building blocks of programming

**Small functions with one obvious, clearly-defined task are good practice**
</div>


## Defining a Function

- You will often need to write your own functions
- They take a standard form

```{r, eval=FALSE}
<function_name> <- function(<arg1>, <arg2>) {
  <do something>
  return(<result>)
}
```

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

```{r, eval=FALSE}
my_sum <- function(a, b) {
  the_sum <- a + b
  return(the_sum)
}
```


## Documentating Functions

- So far, you've been able to use `R`'s built-in help to see function documentation
  - This isn't available for your own functions unless you write it

<center>    
<div class="highlight">
**Your future self will thank you!**

(and so will your colleagues)

*Write programs for people, not for computers*
</div>
</center>

- State what the code does (and why)
- Define inputs and outputs
- Give an example

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>


## Function Arguments

- We can define functions that take multiple arguments
- We can also define default values for arguments

<center>
<div class="attention">
**INTERACTIVE DEMO**
</div>
</center>

```{r, eval=FALSE}
# Report countries in gapminder data
list_countries <- function(data, letter=NULL) {
  countries <- levels(data$country)
  if (!is.null(letter)) {
    matches <- startsWith(countries, letter)
    countries <- countries[matches]
  }
  return(countries)
}
```